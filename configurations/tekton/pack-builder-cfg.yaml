type: tekton
domain: buildpack
namespace:

job:
  # One of the supported resources: PipelineRun, Pipeline
  resourceType: PipelineRun
  name: pack-builder-push
  description: "This Pipeline builds a builder image using the pack CLI."
  actions:
    - name: git-clone
      ref: bundle://quay.io/konflux-ci/tekton-catalog/task-git-clone:0.1@sha256:de0ca8872c791944c479231e21d68379b54877aaf42e5f766ef4a8728970f8b3
      params:
        - url: "$(params.git-url)"
        - subdirectory: "."
    - name: fetch-packconfig-registrysecret
      ref: bundle://quay.io/ch007m/tekton-bundle:latest@sha256:af13b94347457df001742f8449de9edb381e90b0d174da598ddd15cf493e340f
    - name: list-source-workspace
      ref: bundle://quay.io/ch007m/tekton-bundle:latest@sha256:af13b94347457df001742f8449de9edb381e90b0d174da598ddd15cf493e340f
    - name: pack-builder
      ref: bundle://quay.io/ch007m/tekton-bundle:latest@sha256:af13b94347457df001742f8449de9edb381e90b0d174da598ddd15cf493e340f
      params:
        - PACK_SOURCE_DIR: "$(params.source-dir)"
        - PACK_CLI_IMAGE: "$(params.imageUrl)"
        - PACK_CLI_IMAGE_VERSION: "$(params.imageTag)"
        - BUILDER_IMAGE_NAME: "$(params.output-image)"
        - PACK_BUILDER_TOML: "ubi-builder.toml"
        - PACK_CMD_FLAGS:
          - "$(params.packCmdBuilderFlags)"

